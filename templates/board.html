{{define "board"}}
<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Rave Bingo</title>
    <link rel="stylesheet" href="/css/main.css">
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script>
    $(document).ready(function() {
        console.log("bingo begins");
        $("#sendit").click(function() {
            var boardData = JSON.stringify( $("#board").serializeArray() );
            $.ajax({
                url : "/board",
                type: "POST",
                processData: false,
                data: boardData,
                success: function(data, textStatus, jqXHR)
                {
                    // parse out the data and stick it into the DOM
                    console.log(data);
                    $("#avgCalls").text(data.AverageCallsUntilWin)
                    $("#shape1").text(data.WinsForEachShape[0] || 0)
                    $("#shape2").text(data.WinsForEachShape[1] || 0)
                },
                error: function (jqXHR, textStatus, errorThrown)
                {
                    console.log(errorThrown);
                }
            });

        });
    });
</script>
</head>
<body>
<div id="buttons">
    <h1>Set up your bingo board</h1>

    <P>For each square, enter the number, and check the boxes for each shape that requires that box. Shape 1 (arrow) is the left box; shape 2 (heart) is the right box.</P>
    <form id="board" method="post">
        <table>
            <tr><th>B</th><th>I</th><th>N</th><th>G</th><th>O</th></tr>
            {{range .Rows}}
            <tr>
                {{ range . }}
                  <td>{{template "square" .}}</td>
                {{ end }}
            </tr>
            {{end}}
        </table>
        <P>Numbers already called:</P>
        {{range $i := N 1 15}}
        <span>{{$i}}<input type="checkbox" name="called" value="called_{{$i}}"/></span>
        {{end}}
        <br>
        {{range $i := N 16 30}}
        <span>{{$i}}<input type="checkbox" name="called" value="called_{{$i}}"/></span>
        {{end}}
        <br>
        {{range $i := N 31 45}}
        <span>{{$i}}<input type="checkbox" name="called" value="called_{{$i}}"/></span>
        {{end}}
        <br>
        {{range $i := N 46 60}}
        <span>{{$i}}<input type="checkbox" name="called" value="called_{{$i}}"/></span>
        {{end}}
        <br>
        {{range $i := N 61 75}}
        <span>{{$i}}<input type="checkbox" name="called" value="called_{{$i}}"/></span>
        {{end}}
        <br>
        <input type="button" id="sendit" name="sendit" value="sendit"/>
    </form>
</div>
<br>
<div id="results">
<p>Average calls before this board wins: <span id="avgCalls"></span></p>
    <p>Scenarios where shape 1 wins: <span id="shape1"></span></p>
    <p>Scenarios where shape 2 wins: <span id="shape2"></span></p>
</div>

</body>
</html>
{{end}}

{{define "square"}}
    <input size="2" maxlength="2" value="{{.Number}}" name="square_id_{{.Number}}" />
    <br/>
    <input type="checkbox" {{if (index .Needed 0)}}checked{{end}} name="square_needed_{{.Number}}_0"/>
    <input type="checkbox" {{if (index .Needed 1)}}checked{{end}} name="square_needed_{{.Number}}_1"/>
{{end}}
